
{% extends 'catalog/base.html' %}

{% block title %}Substituts{% endblock %}

{% block content %}
<div class="container-fluid py-5 px-0">
    <div class="banner" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url({{product.picture}});">
        <div class="container">
            <h2>{{product.name}}</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-12 pt-5 pb-3 px-0 text-center">
            {% if substitutes|length == 0 %}
                <h2>Nous n'avons pas de substitut à proposer pour ce produit</h2>
            {% else %}
                <h2>Vous pouvez remplacer cet aliment par:</h2>
            {% endif %}
        </div>
    </div>
    <div class="searchpage-container">
        <div class="cards-product">
            {% if products.count == 0 %}
                <p>Désolé votre recherche n'a donné aucun résultat</p>
            {% else %}
                {% for substitute in substitutes %}
                <div class="product">
                    <a href="{% url 'product_detail' product_pk=substitute.id %}" class="card-product-link">
                        <div class="card-product">
                            <img src={{ substitute.picture }} alt="food picture">
                            <div class="card-product-infos">
                                <div>
                                    <h2 class="card-product-name">{{substitute.name}}</h2>
                                </div>
                                {% if substitute.nutriscore == "A" %}
                                    <h2 class="card-product-nutriscore-a">A</h2>
                                {% elif substitute.nutriscore == "B" %}
                                    <h2 class="card-product-nutriscore-b">B</h2>
                                {% elif substitute.nutriscore == "C" %}
                                    <h2 class="card-product-nutriscore-c">C</h2>
                                {% elif substitute.nutriscore == "D" %}
                                    <h2 class="card-product-nutriscore-d">D</h2>
                                {% elif substitute.nutriscore == "E" %}
                                    <h2 class="card-product-nutriscore-e">E</h2>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                    <a href="" id="ajax-call" type="submit">
                        <div class="call-to-action" type="submit">
                            <i class="far fa-save"></i>
                            <p>Sauvegarder</p>
                        </div>
                    </a>
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.querySelector("#ajax-call").addEventListener("click", event => {
        let formData = new FormData();
        formData.append('favorite', document.querySelector("#a").value);
    })

    const request = new Request('{% url "favorite_save" %}', {method: 'POST', body: formData});

    fetch(request)
        .then(response => response.json())
        .then(result => {
            console.log(result);
        })
</script>
{% endblock content %}
